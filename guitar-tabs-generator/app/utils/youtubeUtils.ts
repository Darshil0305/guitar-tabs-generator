// Extract video ID from YouTube URL
export const extractVideoId = (url: string): string | null => {
  // Handle standard YouTube URL format
  const standardRegex = /(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
  const match = url.match(standardRegex);
  
  return match ? match[1] : null;
};

// Get song information from video ID (in a real app, this would call the YouTube API)
export const getSongInfo = async (videoId: string) => {
  // For demo purposes, we'll simulate an API call with a delay
  return new Promise((resolve) => {
    setTimeout(() => {
      // Predefined songs for demo
      const songDatabase: Record<string, { title: string; artist: string }> = {
        'dQw4w9WgXcQ': { 
          title: 'Never Gonna Give You Up', 
          artist: 'Rick Astley' 
        },
        '1qU9RXQ3hPQ': { 
          title: 'Hotel California', 
          artist: 'Eagles' 
        },
        'EPfmNxkEaJc': { 
          title: 'Free Fallin', 
          artist: 'Tom Petty' 
        },
        'ZN_8B3xCgHM': { 
          title: 'Nothing Else Matters', 
          artist: 'Metallica' 
        },
        'YR5ApYxkU-U': { 
          title: 'Purple Haze', 
          artist: 'Jimi Hendrix' 
        },
      };
      
      // Lookup the song in our "database" or generate random info for other video IDs
      const song = songDatabase[videoId] || {
        title: `Song Title (ID: ${videoId})`,
        artist: 'Unknown Artist'
      };
      
      resolve({
        ...song,
        videoId
      });
    }, 1000); // Simulate network delay
  });
};

// Generate guitar tabs based on song and options (in a real app, this would use a tab API)
export const generateTabs = async (
  videoId: string, 
  useCapo: boolean, 
  isFingerStyle: boolean
) => {
  // For demo purposes, we'll simulate an API call with predefined tabs
  return new Promise((resolve) => {
    setTimeout(() => {
      const tabsDatabase: Record<string, { 
        standard: string; 
        capo: string;
        fingerstyle: string;
        fingerstyleCapo: string;
      }> = {
        // Rick Astley - Never Gonna Give You Up
        'dQw4w9WgXcQ': {
          standard: `
E|------------------------------|------------------------------|
B|------------------------------|------------------------------|
G|------------------------------|------------------------------|
D|--2--2--4--2--0--------------|--2--2--4--2--0--------------|
A|------------------2--0--------|------------------2--0--------|
E|------------------------------|------------------------------|

E|------------------------------|------------------------------|
B|------------------------------|------------------------------|
G|------------------------------|------------------------------|
D|--2--2--4--2--0--------------|--2--2--4--2--0--------------|
A|------------------2--0--------|------------------2--0--------|
E|------------------------------|------------------------------|

Never gonna give you up, never gonna let you down
          `,
          capo: `
E|------------------------------|------------------------------|
B|------------------------------|------------------------------|
G|------------------------------|------------------------------|
D|--0--0--2--0-----------------|--0--0--2--0-----------------|
A|----------------3--2--0-------|----------------3--2--0-------|
E|------------------------------|------------------------------|

E|------------------------------|------------------------------|
B|------------------------------|------------------------------|
G|------------------------------|------------------------------|
D|--0--0--2--0-----------------|--0--0--2--0-----------------|
A|----------------3--2--0-------|----------------3--2--0-------|
E|------------------------------|------------------------------|

Never gonna give you up, never gonna let you down
Capo on 2nd fret
          `,
          fingerstyle: `
E|------------------------------|------------------------------|
B|------------------------------|------------------------------|
G|----4--2--0--------------------|----4--2--0--------------------|
D|--2--------------2--0---------|--2--------------2--0---------|
A|------------------2------------|------------------2------------|
E|--0---------------------------|--0---------------------------|

E|------------------------------|------------------------------|
B|------------------------------|------------------------------|
G|----4--2--0--------------------|----4--2--0--------------------|
D|--2--------------2--0---------|--2--------------2--0---------|
A|------------------2------------|------------------2------------|
E|--0---------------------------|--0---------------------------|

Never gonna give you up, never gonna let you down
          `,
          fingerstyleCapo: `
E|------------------------------|------------------------------|
B|------------------------------|------------------------------|
G|----2--0----------------------|----2--0----------------------|
D|--0--------------0------------|--0--------------0------------|
A|------------------3--2--0-----|------------------3--2--0-----|
E|------------------------------|------------------------------|

E|------------------------------|------------------------------|
B|------------------------------|------------------------------|
G|----2--0----------------------|----2--0----------------------|
D|--0--------------0------------|--0--------------0------------|
A|------------------3--2--0-----|------------------3--2--0-----|
E|------------------------------|------------------------------|

Never gonna give you up, never gonna let you down
Capo on 2nd fret
          `
        },
        // Default tab for any other video
        'default': {
          standard: `
E|----0-----0-----0-----0-------|----0-----0-----0-----0-------|
B|----1-----1-----1-----1-------|----1-----1-----1-----1-------|
G|----0-----0-----0-----0-------|----0-----0-----0-----0-------|
D|----2-----2-----2-----2-------|----2-----2-----2-----2-------|
A|----3-----3-----3-----3-------|----3-----3-----3-----3-------|
E|-----------------------------|-----------------------------|

E|----3-----3-----3-----3-------|----3-----3-----3-----3-------|
B|----0-----0-----0-----0-------|----0-----0-----0-----0-------|
G|----0-----0-----0-----0-------|----0-----0-----0-----0-------|
D|----0-----0-----0-----0-------|----0-----0-----0-----0-------|
A|----2-----2-----2-----2-------|----2-----2-----2-----2-------|
E|----3-----3-----3-----3-------|----3-----3-----3-----3-------|

Strumming Pattern: D DU UDU (Down, Down-Up, Up-Down-Up)
          `,
          capo: `
E|----0-----0-----0-----0-------|----0-----0-----0-----0-------|
B|----1-----1-----1-----1-------|----1-----1-----1-----1-------|
G|----0-----0-----0-----0-------|----0-----0-----0-----0-------|
D|----2-----2-----2-----2-------|----2-----2-----2-----2-------|
A|----3-----3-----3-----3-------|----3-----3-----3-----3-------|
E|-----------------------------|-----------------------------|

E|----3-----3-----3-----3-------|----3-----3-----3-----3-------|
B|----0-----0-----0-----0-------|----0-----0-----0-----0-------|
G|----0-----0-----0-----0-------|----0-----0-----0-----0-------|
D|----0-----0-----0-----0-------|----0-----0-----0-----0-------|
A|----2-----2-----2-----2-------|----2-----2-----2-----2-------|
E|----3-----3-----3-----3-------|----3-----3-----3-----3-------|

Strumming Pattern: D DU UDU (Down, Down-Up, Up-Down-Up)
Capo on 2nd fret
          `,
          fingerstyle: `
E|--0--------0-------------------|--0--------0-------------------|
B|------1--------1--------------|------1--------1--------------|
G|----------0--------0----------|----------0--------0----------|
D|-----------------------------|-----------------------------|
A|-----------------------------|-----------------------------|
E|--3--------3--------3---------|--3--------3--------3---------|

E|--3--------3-------------------|--3--------3-------------------|
B|------0--------0--------------|------0--------0--------------|
G|----------0--------0----------|----------0--------0----------|
D|----------0--------0----------|----------0--------0----------|
A|-----------------------------|-----------------------------|
E|--3--------3--------3---------|--3--------3--------3---------|

Thumb plays bass notes (low E, A), fingers play melody
          `,
          fingerstyleCapo: `
E|--0--------0-------------------|--0--------0-------------------|
B|------1--------1--------------|------1--------1--------------|
G|----------0--------0----------|----------0--------0----------|
D|-----------------------------|-----------------------------|
A|-----------------------------|-----------------------------|
E|--3--------3--------3---------|--3--------3--------3---------|

E|--3--------3-------------------|--3--------3-------------------|
B|------0--------0--------------|------0--------0--------------|
G|----------0--------0----------|----------0--------0----------|
D|----------0--------0----------|----------0--------0----------|
A|-----------------------------|-----------------------------|
E|--3--------3--------3---------|--3--------3--------3---------|

Thumb plays bass notes (low E, A), fingers play melody
Capo on 2nd fret
          `
        }
      };
      
      // Get the appropriate tab based on the options
      const tabSet = tabsDatabase[videoId] || tabsDatabase['default'];
      
      let tabContent = '';
      if (useCapo && isFingerStyle) {
        tabContent = tabSet.fingerstyleCapo;
      } else if (useCapo && !isFingerStyle) {
        tabContent = tabSet.capo;
      } else if (!useCapo && isFingerStyle) {
        tabContent = tabSet.fingerstyle;
      } else {
        tabContent = tabSet.standard;
      }
      
      resolve(tabContent);
    }, 2000); // Simulate the tab generation processing time
  });
};
